# ğŸ“¦ API de GestiÃ³n de Proyectos

Esta API permite gestionar usuarios, proyectos, movimientos y lÃ­neas dentro de un sistema de seguimiento financiero.

## ğŸ“Œ InstalaciÃ³n
```bash
git clone https://github.com/cristianCor19/test
cd test
npm install
npm start

ğŸ” AutenticaciÃ³n
ğŸ“ Registro de Usuario
Endpoint: POST /user/save
DescripciÃ³n: Crea un nuevo usuario en el sistema y devuelve un token JWT.
Body (JSON):{
  "name": "Juan PÃ©rez",
  "email": "juanperez@example.com",
  "password": "P@ssw0rd123"
}

Respuesta exitosa (201):{
  "message": "Usuario registrado correctamente",
  "token": "eyJhbGciOiJIUzI1NiIsInR..."
}

ğŸ”‘ Login de Usuario
Endpoint: POST /auth/login
DescripciÃ³n: Inicia sesiÃ³n y devuelve un token JWT.
Body (JSON):{
  "name: "juan",
  "email": "juanperez@example.com",
  "password": "P@ssw0rd123"
}

Respuesta exitosa (200):{
  "token": "eyJhbGciOiJIUzI1NiIsInR..."
}

ğŸ“‚ GestiÃ³n de Proyectos
ğŸ“Œ Crear Proyecto
Endpoint: POST /project/save
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)
Headers: 
{
  "Authorization": "Bearer <token>"
}

Body (JSON):{
  "name": "Proyecto Ejemplo"
}

ğŸ“¤ Respuesta exitosa (201):
{
  "status": true,
  "project": {
    "_id": "65a7306e4f1d8e001c12e678",
    "name": "Proyecto Ejemplo",
    "creator": "65a72f9e4f1d8e001c12e345",
  },
  "message": "Proyecto creado"
}

ğŸ“‹ Obtener todos los proyectos del usuario
ğŸ“Œ Endpoint: GET /project/
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)
Headers: 
{
  "Authorization": "Bearer <token>"
}

ğŸ“¤ Respuesta exitosa (200):
{
  "status": true,
  "projects": [
    {
      "_id": "65a7306e4f1d8e001c12e678",
      "name": "Proyecto 1",
      "creator": "65a72f9e4f1d8e001c12e345"
    },
    {
      "_id": "65a7306e4f1d8e001c12e679",
      "name": "Proyecto 2",
      "creator": "65a72f9e4f1d8e001c12e345"
    }
  ]
}

ğŸ—‘ Eliminar uno o mÃ¡s proyectos
ğŸ“Œ Endpoint: DELETE /project/delete
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)
Headers: {
  "Authorization": "Bearer <token>"
}

ğŸ“¥ Body (JSON):
{
  "projectIds": ["65a7306e4f1d8e001c12e678", "65a7306e4f1d8e001c12e679"]
} 

ğŸ“¤ Respuesta exitosa (200):
{
  "status": true,
  "message": "proyectos borrados correctamente"
}


ğŸ“‘ PaginaciÃ³n en el Buscador de Proyectos
Endpoint: GET /project/search
Query Params:

| ParÃ¡metro | Tipo   | DescripciÃ³n                |
|-----------|--------|---------------------------|
| value     | String | Nombre a buscar           |
| page      | Number | NÃºmero de pÃ¡gina          |
| limit     | Number | Resultados por pÃ¡gina     |

Ejemplo de Request:

GET /project/search?value=Ejemplo&page=1&limit=10

Respuesta (200):
{
  "projects": [
    { "id": "1", "name": "Proyecto Ejemplo 1" },
    { "id": "2", "name": "Proyecto Ejemplo 2" }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 2
  }
}


ğŸ“‚ GestiÃ³n de Movimientos
ğŸš€ Crear un Movimiento
ğŸ“Œ Endpoint: POST /movement/save/:projectId/
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)
Headers: {
  "Authorization": "Bearer <token>"
}
ğŸ“¥ Body (JSON)" {
  "name": "Movimiento Ejemplo"
}

ğŸ“¤ Respuesta exitosa (201):{
  "status": true,
  "Movimiento": {
    "_id": "65a7312f4f1d8e001c12e789",
    "name": "Movimiento Ejemplo",
    "project": "65a7306e4f1d8e001c12e678",
    "createdAt": "2025-02-12T10:00:00.000Z",
    "updatedAt": "2025-02-12T10:00:00.000Z"
  },
  "message": "Movimiento creado"
}

ğŸ“‹ Obtener todos los movimientos de un proyecto
ğŸ“Œ Endpoint: GET /movement/:projectId
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)
Headers: {
  "Authorization": "Bearer <token>"
}

ğŸ“¤ Respuesta exitosa (200):{
  "status": true,
  "movements": [
    {
      "_id": "65a7312f4f1d8e001c12e789",
      "name": "Movimiento 1",
      "project": "65a7306e4f1d8e001c12e678"
    },
    {
      "_id": "65a7313e4f1d8e001c12e790",
      "name": "Movimiento 2",
      "project": "65a7306e4f1d8e001c12e678"
    }
  ]
}

ğŸ—‘ Eliminar uno o mÃ¡s movimientos
ğŸ“Œ Endpoint: DELETE /movement/delete/:projectId
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)
Headers: {
  "Authorization": "Bearer <token>"
}
ğŸ“¥ Body (JSON): {
  "movementIds": ["65a7312f4f1d8e001c12e789", "65a7313e4f1d8e001c12e790"]
}

ğŸ“¤ Respuesta exitosa (200):{
  "status": true,
  "message": "movimientos borrados correctamente"
}


ğŸ“‚ GestiÃ³n de LÃ­neas
ğŸš€ Crear una LÃ­nea
ğŸ“Œ Endpoint: POST /line/save/:movementId/
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)

Headers:{
  "Authorization": "Bearer <token>"
}

ğŸ“¥ Body (JSON):{
  "name": "LÃ­nea Ejemplo"
}

ğŸ“¤ Respuesta exitosa (201):{
  "status": true,
  "Linea": {
    "_id": "65a7312f4f1d8e001c12e789",
    "name": "LÃ­nea Ejemplo",
    "movement": "65a7306e4f1d8e001c12e678",
    "createdAt": "2025-02-12T10:00:00.000Z",
    "updatedAt": "2025-02-12T10:00:00.000Z"
  },
  "message": "LÃ­nea creada"
}

ğŸ“‹ Obtener todas las lÃ­neas de un movimiento
ğŸ“Œ Endpoint: GET /line/:movementId
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)

Headers:{
  "Authorization": "Bearer <token>"
}

ğŸ“¤ Respuesta exitosa (200): {
  "status": true,
  "Lineas": [
    {
      "_id": "65a7312f4f1d8e001c12e789",
      "name": "LÃ­nea 1",
      "movement": "65a7306e4f1d8e001c12e678"
    },
    {
      "_id": "65a7313e4f1d8e001c12e790",
      "name": "LÃ­nea 2",
      "movement": "65a7306e4f1d8e001c12e678"
    }
  ]
}

ğŸ—‘ Eliminar una o mÃ¡s lÃ­neas
ğŸ“Œ Endpoint: DELETE /line/delete/:movementId
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)

Headers: {
  "Authorization": "Bearer <token>"
}

ğŸ“¥ Body (JSON):{
  "LinesIds": ["65a7312f4f1d8e001c12e789", "65a7313e4f1d8e001c12e790"]
}

ğŸ“¤ Respuesta exitosa (200): {
  "status": true,
  "message": "lÃ­neas borradas correctamente"
}

ğŸ”„ Actualizar valores en una lÃ­nea y propagar cambios
ğŸ“Œ Endpoint: PUT /line/update/:lineId
ğŸ”‘ Requiere autenticaciÃ³n: âœ… SÃ­ (Token JWT en Headers)

Headers: {
  "Authorization": "Bearer <token>"
}

ğŸ“¥ Body (JSON): {
  "sumPrice": 1000,
  "sumBudget": 800
}

ğŸ“¤ Respuesta exitosa (200):{
  "status": true,
  "line": {
    "_id": "65a7312f4f1d8e001c12e789",
    "name": "LÃ­nea Ejemplo",
    "movement": "65a7306e4f1d8e001c12e678",
    "numbers": {
      "sumPrice": {
        "number": 1000,
        "value": "$ 1000.00"
      },
      "sumBudget": {
        "number": 800,
        "value": "$ 800.00"
      },
      "budgetUtility": {
        "number": 200,
        "value": "$ 200.00"
      },
      "budgetMargin": {
        "number": 20,
        "value": "20.00 %"
      }
    },
    "updatedAt": "2025-02-12T11:00:00.000Z"
  },
  "message": "LÃ­nea actualizada y valores propagados"
}

ğŸ”„ Propagar cambios a Movimientos y Proyectos
Estos cambios son automÃ¡ticos cuando se actualizan los valores de una lÃ­nea. La API calcula automÃ¡ticamente la utilidad presupuestada y el margen presupuestado en los niveles superiores (Movimientos y Proyectos).

ğŸ“Œ CÃ¡lculo de valores:

Presupuesto total (sumBudget) = Suma de presupuestos de todas las lÃ­neas del movimiento.
Precio total (sumPrice) = Suma de precios de todas las lÃ­neas del movimiento.
Utilidad presupuestada = sumPrice - sumBudget
Margen presupuestado = (utilidad presupuestada / sumPrice) * 100
ğŸ“Œ La actualizaciÃ³n de valores se propaga en cascada:
âœ… LÃ­nea â†’ Movimiento â†’ Proyecto











